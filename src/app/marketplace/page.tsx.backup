'use client';

import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { loadProfile } from '@/lib/load-profile';
import { Profile } from '../profile/page';
import { useAuthorize } from '@/lib/useAuthorize';


const Marketplace = () => {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [sortBy, setSortBy] = useState('recent');
  const [favorites, setFavorites] = useState(new Set());
  const [scrollY, setScrollY] = useState(0);
  const [showContactModal, setShowContactModal] = useState(false);
  const [selectedItem, setSelectedItem] = useState(null);
  const [priceRange, setPriceRange] = useState([0, 1000]);
  const [showFilters, setShowFilters] = useState(false);

  // authorization
  const router = useRouter();
  const { auth, user, token, loading } = useAuthorize();

  React.useEffect(() => {
    if(loading) return;
    
    if (auth && token)
    console.log("Stored user: ", user);
    else {
      console.log("User not logged in.");
      console.log("auth: " + auth, ". token: " + token);
      router.replace("/");
    }
  }, [auth, token, user, loading, router]); 


  useEffect(() => {
    const handleScroll = () => setScrollY(window.scrollY);
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const categories = [
    { id: 'all', name: 'All Items', icon: '', color: '#D22030' },
    { id: 'textbooks', name: 'Textbooks', icon: '', color: '#8b5cf6' },
    { id: 'electronics', name: 'Electronics', icon: '', color: '#3b82f6' },
    { id: 'furniture', name: 'Furniture', icon: '', color: '#10b981' },
    { id: 'clothing', name: 'Clothing', icon: '', color: '#f59e0b' },
    { id: 'accessories', name: 'Accessories', icon: '', color: '#ec4899' }
  ];

  const listings = [
    {
      id: 1,
      title: 'Calculus 11th Edition',
      price: 55,
      originalPrice: 120,
      image: 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=600&h=400&fit=crop',
      seller: 'Sarah M.',
      sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
      rating: 4.9,
      reviews: 127,
      condition: 'Like New',
      location: 'Northridge Campus',
      posted: '2 hours ago',
      category: 'textbooks',
      trending: true,
      views: 234,
      description: 'Excellent condition, minimal highlighting. Comes with access code.'
    },
    {
      id: 2,
      title: 'Sony WH-1000XM4 Headphones',
      price: 180,
      originalPrice: 349,
      image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=600&h=400&fit=crop',
      seller: 'John D.',
      sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=John',
      rating: 4.7,
      reviews: 89,
      condition: 'Excellent',
      location: 'Sierra Hall',
      posted: '5 hours ago',
      category: 'electronics',
      views: 189
    },
    {
      id: 3,
      title: 'iPad Pro 11" 2021 - 256GB',
      price: 450,
      originalPrice: 799,
      image: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=600&h=400&fit=crop',
      seller: 'Emily R.',
      sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Emily',
      rating: 5.0,
      reviews: 203,
      condition: 'Like New',
      location: 'University Student Union',
      posted: '1 day ago',
      category: 'electronics',
      trending: true,
      views: 512
    },
    {
      id: 4,
      title: 'Mini Refrigerator - Perfect for Dorms',
      price: 75,
      originalPrice: 150,
      image: 'https://images.unsplash.com/photo-1571175443880-49e1d25b2bc5?w=600&h=400&fit=crop',
      seller: 'Mike T.',
      sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Mike',
      rating: 4.8,
      reviews: 56,
      condition: 'Good',
      location: 'University Park Apartments',
      posted: '3 days ago',
      category: 'furniture',
      views: 145
    },
    {
      id: 5,
      title: 'Official CSUN Hoodie - Size M',
      price: 25,
      originalPrice: 45,
      image: 'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=600&h=400&fit=crop',
      seller: 'Alex K.',
      sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex',
      rating: 4.6,
      reviews: 34,
      condition: 'Like New',
      location: 'Matador Bookstore',
      posted: '1 week ago',
      category: 'clothing',
      views: 98
    },
    {
      id: 6,
      title: 'Modern LED Desk Lamp with USB Port',
      price: 20,
      originalPrice: 40,
      image: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=600&h=400&fit=crop',
      seller: 'Lisa W.',
      sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Lisa',
      rating: 4.9,
      reviews: 78,
      condition: 'Excellent',
      location: 'Oviatt Library Area',
      posted: '4 days ago',
      category: 'furniture',
      views: 167
    }
  ];

  const toggleFavorite = (id: number) => {
    setFavorites(prev => {
      const newFavorites = new Set(prev);
      if (newFavorites.has(id)) {
        newFavorites.delete(id);
      } else {
        newFavorites.add(id);
      }
      return newFavorites;
    });
  };

  const handleContactSeller = (item: any) => {
    setSelectedItem(item);
    setShowContactModal(true);
  };

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    console.log('Searching for:', searchQuery);
    // Search functionality already works through filteredListings
  };

  const filteredListings = listings.filter(item => {
    const matchesCategory = selectedCategory === 'all' || item.category === selectedCategory;
    const matchesSearch = item.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         item.description?.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesPrice = item.price >= priceRange[0] && item.price <= priceRange[1];
    return matchesCategory && matchesSearch && matchesPrice;
  });

  const sortedListings = [...filteredListings].sort((a, b) => {
    switch (sortBy) {
      case 'price-low': return a.price - b.price;
      case 'price-high': return b.price - a.price;
      case 'popular': return b.views - a.views;
      default: return 0;
    }
  });

  const getCategoryColor = (categoryId: string) => {
    return categories.find(c => c.id === categoryId)?.color || '#D22030';
  };

  if (!auth) return null;

  return (
    <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', position: 'relative' }}>
      {/* Animated Background */}
      <div style={{
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        background: 'linear-gradient(135deg, #1e1e2e 0%, #2a1a3d 100%)',
        zIndex: 0
      }}>
        <div style={{
          position: 'absolute',
          width: '100%',
          height: '100%',
          background: 'radial-gradient(circle at 20% 50%, rgba(210, 32, 48, 0.15) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%)',
          animation: 'pulse 8s ease-in-out infinite'
        }} />
      </div>

      <div style={{ position: 'relative', zIndex: 1 }}>
        {/* Back Button */}
        <button
          onClick={() => window.location.href = "/dashboard"}
          style={{
            position: "fixed",
            top: "1.5rem",
            left: "1.5rem",
            zIndex: 100,
            background: "rgba(255, 255, 255, 0.15)",
            backdropFilter: "blur(8px)",
            padding: "0.75rem 0.9rem",
            borderRadius: "50%",
            border: "1px solid rgba(255, 255, 255, 0.25)",
            cursor: "pointer",
            transition: "all 0.25s ease",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            boxShadow: "0 4px 12px rgba(0,0,0,0.25)"
          }}
          onMouseEnter={(e) => {
            const el = e.currentTarget as HTMLElement;
            el.style.transform = "scale(1.15)";
            el.style.background = "rgba(255, 255, 255, 0.25)";
          }}
          onMouseLeave={(e) => {
            const el = e.currentTarget as HTMLElement;
            el.style.transform = "scale(1)";
            el.style.background = "rgba(255, 255, 255, 0.15)";
          }}
        >
          {/* Arrow Icon */}
          <svg
            width="22"
            height="22"
            fill="none"
            stroke="white"
            strokeWidth="3"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <polyline points="15 18 9 12 15 6" />
          </svg>
        </button>

        {/* Premium Hero Section */}
        <div 
          style={{
            position: 'relative',
            background: 'linear-gradient(135deg, rgba(210, 32, 48, 0.95) 0%, rgba(139, 25, 35, 0.95) 100%)',
            color: 'white',
            overflow: 'hidden',
            backdropFilter: 'blur(20px)',
            borderBottom: '1px solid rgba(255, 255, 255, 0.1)'
          }}
        >
          {/* Animated Shapes */}
          <div style={{
            position: 'absolute',
            top: '-50%',
            right: '-10%',
            width: '500px',
            height: '500px',
            background: 'radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%)',
            borderRadius: '50%',
            animation: 'float 20s ease-in-out infinite'
          }} />
          <div style={{
            position: 'absolute',
            bottom: '-30%',
            left: '-5%',
            width: '400px',
            height: '400px',
            background: 'radial-gradient(circle, rgba(255, 255, 255, 0.08) 0%, transparent 70%)',
            borderRadius: '50%',
            animation: 'float 15s ease-in-out infinite reverse'
          }} />
          
          <div style={{ 
            maxWidth: '1400px', 
            margin: '0 auto', 
            padding: '4rem 2rem', 
            position: 'relative', 
            zIndex: 10 
          }}>
            <div style={{ textAlign: 'center', marginBottom: '3rem' }}>
              <div style={{
                display: 'inline-block',
                background: 'rgba(255, 255, 255, 0.15)',
                backdropFilter: 'blur(10px)',
                padding: '0.5rem 1.5rem',
                borderRadius: '50px',
                marginBottom: '1.5rem',
                border: '1px solid rgba(255, 255, 255, 0.2)',
                fontSize: '0.875rem',
                fontWeight: '600',
                letterSpacing: '0.5px'
              }}>
                CSUN EXCLUSIVE MARKETPLACE
              </div>
              
              <h1 style={{ 
                fontSize: '4.5rem', 
                fontWeight: '900', 
                marginBottom: '1rem',
                background: 'linear-gradient(to right, #ffffff, #fecaca)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                backgroundClip: 'text',
                letterSpacing: '-2px',
                lineHeight: '1.1'
              }}>
                Community Hub
              </h1>
              <p style={{ 
                fontSize: '1.5rem', 
                marginBottom: '0', 
                color: 'rgba(255, 255, 255, 0.9)',
                fontWeight: '400',
                maxWidth: '600px',
                margin: '0 auto'
              }}>
                Buy and sell with fellow Matadors. Safe, local, and convenient.
              </p>
            </div>

            {/* Advanced Search Bar */}
            <form onSubmit={handleSearch} style={{ maxWidth: '900px', margin: '0 auto', position: 'relative' }}>
              <div style={{
                position: 'relative',
                background: 'rgba(255, 255, 255, 0.98)',
                borderRadius: '20px',
                boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)',
                padding: '0.75rem',
                display: 'flex',
                alignItems: 'center',
                gap: '1rem',
                backdropFilter: 'blur(20px)'
              }}>
                <div style={{ marginLeft: '1rem', color: '#6b7280' }}>
                  <svg width="28" height="28" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                  </svg>
                </div>
                <input
                  type="text"
                  placeholder="Search for textbooks, electronics, furniture..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  style={{
                    flex: 1,
                    padding: '1rem',
                    outline: 'none',
                    color: '#111827',
                    fontSize: '1.125rem',
                    border: 'none',
                    background: 'transparent',
                    fontWeight: '500'
                  }}
                />
                <button 
                  type="button"
                  onClick={() => setShowFilters(!showFilters)}
                  style={{
                    background: showFilters ? '#D22030' : '#f3f4f6',
                    color: showFilters ? 'white' : '#374151',
                    padding: '1rem 1.5rem',
                    borderRadius: '12px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem',
                    border: 'none',
                    cursor: 'pointer',
                    fontWeight: '600',
                    fontSize: '1rem',
                    transition: 'all 0.3s',
                    boxShadow: showFilters ? '0 4px 12px rgba(210, 32, 48, 0.3)' : 'none'
                  }}
                >
                  <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                  </svg>
                  Filters
                </button>
                <button 
                  type="submit"
                  style={{
                    background: 'linear-gradient(135deg, #D22030 0%, #8b1a1a 100%)',
                    color: 'white',
                    padding: '1rem 2rem',
                    borderRadius: '14px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem',
                    border: 'none',
                    cursor: 'pointer',
                    fontWeight: '700',
                    fontSize: '1.125rem',
                    transition: 'all 0.3s',
                    boxShadow: '0 10px 25px rgba(210, 32, 48, 0.4)'
                  }}
                  onMouseEnter={(e) => {
                    (e.target as HTMLElement).style.transform = 'translateY(-2px)';
                    (e.target as HTMLElement).style.boxShadow = '0 15px 30px rgba(210, 32, 48, 0.5)';
                  }}
                  onMouseLeave={(e) => {
                    (e.target as HTMLElement).style.transform = 'translateY(0)';
                    (e.target as HTMLElement).style.boxShadow = '0 10px 25px rgba(210, 32, 48, 0.4)';
                  }}
                >
                  Search
                </button>
              </div>
            </form>

            {/* Stats */}
            <div style={{ display: 'flex', justifyContent: 'center', gap: '3rem', marginTop: '3rem', flexWrap: 'wrap' }}>
              {[
                { icon: '', label: 'Active Listings', value: '350+' },
                { icon: '', label: 'Avg Rating', value: '4.8' },
                { icon: '', label: 'Happy Users', value: '2.5K+' }
              ].map((stat, i) => (
                <div key={i} style={{
                  background: 'rgba(255, 255, 255, 0.1)',
                  backdropFilter: 'blur(10px)',
                  padding: '1.25rem 2rem',
                  borderRadius: '16px',
                  border: '1px solid rgba(255, 255, 255, 0.2)',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '1rem'
                }}>
                  <span style={{ fontSize: '2rem' }}>{stat.icon}</span>
                  <div>
                    <div style={{ fontSize: '1.75rem', fontWeight: '800' }}>{stat.value}</div>
                    <div style={{ fontSize: '0.875rem', opacity: 0.9 }}>{stat.label}</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Categories Section */}
        <div style={{ 
          position: 'sticky', 
          top: 0, 
          zIndex: 40, 
          background: 'rgba(30, 30, 46, 0.95)',
          backdropFilter: 'blur(20px)',
          boxShadow: '0 4px 20px rgba(0, 0, 0, 0.3)', 
          borderBottom: '1px solid rgba(255, 255, 255, 0.05)' 
        }}>
          <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '1.25rem 2rem' }}>
            <div style={{ display: 'flex', gap: '1rem', overflowX: 'auto', paddingBottom: '0.5rem' }}>
              {categories.map((cat) => (
                <button
                  key={cat.id}
                  onClick={() => setSelectedCategory(cat.id)}
                  style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.75rem',
                    padding: '1rem 2rem',
                    borderRadius: '16px',
                    fontWeight: '700',
                    whiteSpace: 'nowrap',
                    border: selectedCategory === cat.id ? `2px solid ${cat.color}` : '2px solid transparent',
                    cursor: 'pointer',
                    transition: 'all 0.3s',
                    background: selectedCategory === cat.id 
                      ? `linear-gradient(135deg, ${cat.color}ee, ${cat.color})`
                      : 'rgba(255, 255, 255, 0.05)',
                    color: 'white',
                    boxShadow: selectedCategory === cat.id ? `0 8px 20px ${cat.color}40` : 'none',
                    fontSize: '1rem'
                  }}
                  onMouseEnter={(e) => {
                    if (selectedCategory !== cat.id) {
                      (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.1)';
                    }
                    (e.target as HTMLElement).style.transform = 'translateY(-2px)';
                  }}
                  onMouseLeave={(e) => {
                    if (selectedCategory !== cat.id) {
                      (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.05)';
                    }
                    (e.target as HTMLElement).style.transform = 'translateY(0)';
                  }}
                >
                  <span style={{ fontSize: '1.5rem' }}>{cat.icon}</span>
                  <span>{cat.name}</span>
                </button>
              ))}
            </div>
          </div>
        </div>

        {/* Sort & Filter Bar */}
        <div style={{ background: 'rgba(30, 30, 46, 0.7)', borderBottom: '1px solid rgba(255, 255, 255, 0.05)' }}>
          <div style={{ 
            maxWidth: '1400px', 
            margin: '0 auto', 
            padding: '1.25rem 2rem', 
            display: 'flex', 
            justifyContent: 'space-between', 
            alignItems: 'center',
            flexWrap: 'wrap',
            gap: '1rem'
          }}>
            <p style={{ color: 'rgba(255, 255, 255, 0.9)', margin: 0, fontSize: '1.125rem', fontWeight: '600' }}>
              <span style={{ color: '#D22030', fontSize: '1.5rem', fontWeight: '800' }}>{sortedListings.length}</span> items found
            </p>
            <select
              value={sortBy}
              onChange={(e) => setSortBy(e.target.value)}
              style={{
                padding: '0.875rem 1.5rem',
                border: '1px solid rgba(255, 255, 255, 0.1)',
                borderRadius: '12px',
                outline: 'none',
                cursor: 'pointer',
                background: 'rgba(255, 255, 255, 0.05)',
                color: 'white',
                fontWeight: '600',
                fontSize: '1rem',
                backdropFilter: 'blur(10px)'
              }}
            >
              <option value="recent" style={{ background: '#1e1e2e' }}>Most Recent</option>
              <option value="price-low" style={{ background: '#1e1e2e' }}>Price: Low to High</option>
              <option value="price-high" style={{ background: '#1e1e2e' }}>Price: High to Low</option>
              <option value="popular" style={{ background: '#1e1e2e' }}>Most Popular</option>
            </select>
          </div>
        </div>

        {/* Listings Grid */}
        <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '3rem 2rem' }}>
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fill, minmax(380px, 1fr))', 
            gap: '2rem' 
          }}>
            {sortedListings.map((item, index) => (
              <div
                key={item.id}
                style={{
                  background: 'rgba(255, 255, 255, 0.05)',
                  backdropFilter: 'blur(20px)',
                  borderRadius: '24px',
                  border: '1px solid rgba(255, 255, 255, 0.1)',
                  overflow: 'hidden',
                  transition: 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                  cursor: 'pointer',
                  animation: `slideUp 0.6s ease-out ${index * 0.1}s forwards`,
                  opacity: 0,
                  position: 'relative'
                }}
                onMouseEnter={(e) => {
                  const el = e.currentTarget as HTMLElement;
                  el.style.transform = 'translateY(-12px) scale(1.02)';
                  el.style.boxShadow = `0 30px 60px rgba(0, 0, 0, 0.4), 0 0 0 1px ${getCategoryColor(item.category)}40`;
                  el.style.borderColor = `${getCategoryColor(item.category)}60`;
                }}
                onMouseLeave={(e) => {
                  const el = e.currentTarget as HTMLElement;
                  el.style.transform = 'translateY(0) scale(1)';
                  el.style.boxShadow = 'none';
                  el.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                }}
              >
                {/* Image Container */}
                <div style={{ position: 'relative', overflow: 'hidden', height: '16rem' }}>
                  <img
                    src={item.image}
                    alt={item.title}
                    style={{
                      width: '100%',
                      height: '100%',
                      objectFit: 'cover',
                      transition: 'transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)'
                    }}
                    onMouseEnter={(e) => (e.target as HTMLElement).style.transform = 'scale(1.15)'}
                    onMouseLeave={(e) => (e.target as HTMLElement).style.transform = 'scale(1)'}
                  />
                  
                  {/* Gradient Overlay */}
                  <div style={{
                    position: 'absolute',
                    inset: 0,
                    background: 'linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 50%)',
                    opacity: 0,
                    transition: 'opacity 0.3s'
                  }}
                  onMouseEnter={(e) => (e.target as HTMLElement).style.opacity = '1'}
                  />

                  {/* Badges */}
                  <div style={{ position: 'absolute', top: '1rem', left: '1rem', display: 'flex', flexDirection: 'column', gap: '0.5rem', zIndex: 10 }}>
                    {item.trending && (
                      <span style={{
                        background: 'linear-gradient(135deg, #D22030, #8b1a1a)',
                        color: 'white',
                        padding: '0.5rem 1rem',
                        borderRadius: '12px',
                        fontSize: '0.75rem',
                        fontWeight: '800',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '0.4rem',
                        boxShadow: '0 4px 12px rgba(210, 32, 48, 0.4)',
                        textTransform: 'uppercase',
                        letterSpacing: '0.5px'
                      }}>
                        Hot
                      </span>
                    )}
                    <span style={{
                      background: 'linear-gradient(135deg, #10b981, #059669)',
                      color: 'white',
                      padding: '0.5rem 1rem',
                      borderRadius: '12px',
                      fontSize: '0.75rem',
                      fontWeight: '800',
                      boxShadow: '0 4px 12px rgba(16, 185, 129, 0.4)',
                      textTransform: 'uppercase'
                    }}>
                      {item.condition}
                    </span>
                    {item.originalPrice && (
                      <span style={{
                        background: 'rgba(251, 191, 36, 0.95)',
                        color: '#111827',
                        padding: '0.5rem 1rem',
                        borderRadius: '12px',
                        fontSize: '0.75rem',
                        fontWeight: '800',
                        boxShadow: '0 4px 12px rgba(251, 191, 36, 0.4)'
                      }}>
                        -{Math.round((1 - item.price / item.originalPrice) * 100)}% OFF
                      </span>
                    )}
                  </div>

                  {/* Favorite Button */}
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(item.id);
                    }}
                    style={{
                      position: 'absolute',
                      top: '1rem',
                      right: '1rem',
                      background: 'rgba(255, 255, 255, 0.95)',
                      backdropFilter: 'blur(10px)',
                      padding: '0.75rem',
                      borderRadius: '50%',
                      boxShadow: '0 4px 12px rgba(0, 0, 0, 0.2)',
                      border: 'none',
                      cursor: 'pointer',
                      transition: 'all 0.3s',
                      zIndex: 10
                    }}
                    onMouseEnter={(e) => (e.target as HTMLElement).style.transform = 'scale(1.15) rotate(10deg)'}
                    onMouseLeave={(e) => (e.target as HTMLElement).style.transform = 'scale(1) rotate(0deg)'}
                  >
                    <svg
                      width="24"
                      height="24"
                      fill={favorites.has(item.id) ? '#D22030' : 'none'}
                      stroke={favorites.has(item.id) ? '#D22030' : '#374151'}
                      strokeWidth="2.5"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                    >
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                  </button>

                  {/* View Count */}
                  <div style={{
                    position: 'absolute',
                    bottom: '1rem',
                    right: '1rem',
                    background: 'rgba(0, 0, 0, 0.7)',
                    backdropFilter: 'blur(10px)',
                    color: 'white',
                    padding: '0.5rem 1rem',
                    borderRadius: '8px',
                    fontSize: '0.875rem',
                    fontWeight: '600',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem'
                  }}>
                    <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                    {item.views}
                  </div>
                </div>

                {/* Content */}
                <div style={{ padding: '1.5rem' }}>
                  <h3 style={{ 
                    fontWeight: '800', 
                    fontSize: '1.5rem', 
                    marginBottom: '0.75rem', 
                    color: 'white',
                    lineHeight: '1.3',
                    display: '-webkit-box',
                    WebkitLineClamp: 2,
                    WebkitBoxOrient: 'vertical',
                    overflow: 'hidden'
                  }}>
                    {item.title}
                  </h3>
                  
                  {item.description && (
                    <p style={{
                      color: 'rgba(255, 255, 255, 0.6)',
                      fontSize: '0.9rem',
                      marginBottom: '1rem',
                      display: '-webkit-box',
                      WebkitLineClamp: 2,
                      WebkitBoxOrient: 'vertical',
                      overflow: 'hidden',
                      lineHeight: '1.5'
                    }}>
                      {item.description}
                    </p>
                  )}
                  
                  <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>
                    <div>
                      <span style={{ fontSize: '2.25rem', fontWeight: '900', color: '#D22030' }}>
                        ${item.price}
                      </span>
                      {item.originalPrice && (
                        <span style={{ 
                          fontSize: '1rem', 
                          color: 'rgba(255, 255, 255, 0.4)', 
                          textDecoration: 'line-through',
                          marginLeft: '0.5rem'
                        }}>
                          ${item.originalPrice}
                        </span>
                      )}
                    </div>
                    <div style={{ 
                      marginLeft: 'auto',
                      display: 'flex', 
                      alignItems: 'center', 
                      gap: '0.5rem', 
                      background: 'rgba(251, 191, 36, 0.15)', 
                      padding: '0.5rem 1rem', 
                      borderRadius: '12px',
                      border: '1px solid rgba(251, 191, 36, 0.3)'
                    }}>
                      <svg width="18" height="18" fill="#fbbf24" stroke="#fbbf24" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                      </svg>
                      <span style={{ fontSize: '1rem', fontWeight: '700', color: '#fbbf24' }}>
                        {item.rating}
                      </span>
                      <span style={{ fontSize: '0.875rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                        ({item.reviews})
                      </span>
                    </div>
                  </div>

                  {/* Seller Info */}
                  <div style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    gap: '1rem', 
                    marginBottom: '1.25rem', 
                    paddingBottom: '1.25rem', 
                    borderBottom: '1px solid rgba(255, 255, 255, 0.1)' 
                  }}>
                    <img
                      src={item.sellerAvatar}
                      alt={item.seller}
                      style={{
                        width: '3rem',
                        height: '3rem',
                        borderRadius: '50%',
                        border: `3px solid ${getCategoryColor(item.category)}`,
                        objectFit: 'cover'
                      }}
                    />
                    <div style={{ flex: 1 }}>
                      <p style={{ 
                        fontSize: '1rem', 
                        fontWeight: '700', 
                        color: 'white', 
                        margin: 0,
                        marginBottom: '0.25rem'
                      }}>
                        {item.seller}
                      </p>
                      <p style={{ 
                        fontSize: '0.875rem', 
                        color: 'rgba(255, 255, 255, 0.5)', 
                        display: 'flex', 
                        alignItems: 'center', 
                        gap: '0.5rem', 
                        margin: 0 
                      }}>
                        <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                          <circle cx="12" cy="10" r="3"/>
                        </svg>
                        {item.location}
                      </p>
                    </div>
                  </div>

                  {/* Action Buttons */}
                  <div style={{ display: 'flex', gap: '1rem' }}>
                    <button 
                      onClick={() => handleContactSeller(item)}
                      style={{
                        flex: 1,
                        background: `linear-gradient(135deg, ${getCategoryColor(item.category)}, ${getCategoryColor(item.category)}dd)`,
                        color: 'white',
                        padding: '1rem',
                        borderRadius: '14px',
                        border: 'none',
                        cursor: 'pointer',
                        fontWeight: '700',
                        fontSize: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem',
                        transition: 'all 0.3s',
                        boxShadow: `0 4px 12px ${getCategoryColor(item.category)}40`
                      }}
                      onMouseEnter={(e) => {
                        (e.target as HTMLElement).style.transform = 'translateY(-2px)';
                        (e.target as HTMLElement).style.boxShadow = `0 8px 20px ${getCategoryColor(item.category)}60`;
                      }}
                      onMouseLeave={(e) => {
                        (e.target as HTMLElement).style.transform = 'translateY(0)';
                        (e.target as HTMLElement).style.boxShadow = `0 4px 12px ${getCategoryColor(item.category)}40`;
                      }}
                    >
                      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                      </svg>
                      Contact Seller
                    </button>
                    <button style={{
                      background: 'rgba(255, 255, 255, 0.1)',
                      color: 'white',
                      padding: '1rem',
                      borderRadius: '14px',
                      border: '1px solid rgba(255, 255, 255, 0.2)',
                      cursor: 'pointer',
                      transition: 'all 0.3s'
                    }}
                    onMouseEnter={(e) => {
                      (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.15)';
                      (e.target as HTMLElement).style.transform = 'scale(1.1)';
                    }}
                    onMouseLeave={(e) => {
                      (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.1)';
                      (e.target as HTMLElement).style.transform = 'scale(1)';
                    }}
                    >
                      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <circle cx="9" cy="21" r="1"/>
                        <circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                      </svg>
                    </button>
                  </div>

                  {/* Time Posted */}
                  <div style={{ 
                    marginTop: '1rem',
                    display: 'flex', 
                    alignItems: 'center', 
                    justifyContent: 'center',
                    gap: '0.5rem', 
                    fontSize: '0.875rem', 
                    color: 'rgba(255, 255, 255, 0.4)' 
                  }}>
                    <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span>Posted {item.posted}</span>
                  </div>
                </div>
              </div>
            ))}
          </div>

          {/* Load More Button */}
          {sortedListings.length > 0 && (
            <div style={{ display: 'flex', justifyContent: 'center', marginTop: '4rem' }}>
              <button style={{
                background: 'linear-gradient(135deg, #D22030 0%, #8b1a1a 100%)',
                color: 'white',
                padding: '1.25rem 3rem',
                borderRadius: '16px',
                fontWeight: '800',
                fontSize: '1.25rem',
                boxShadow: '0 10px 30px rgba(210, 32, 48, 0.4)',
                border: 'none',
                cursor: 'pointer',
                transition: 'all 0.3s',
                display: 'flex',
                alignItems: 'center',
                gap: '0.75rem'
              }}
              onMouseEnter={(e) => {
                (e.target as HTMLElement).style.transform = 'translateY(-4px) scale(1.05)';
                (e.target as HTMLElement).style.boxShadow = '0 15px 40px rgba(210, 32, 48, 0.5)';
              }}
              onMouseLeave={(e) => {
                (e.target as HTMLElement).style.transform = 'translateY(0) scale(1)';
                (e.target as HTMLElement).style.boxShadow = '0 10px 30px rgba(210, 32, 48, 0.4)';
              }}
              >
                Load More Items
                <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </button>
            </div>
          )}

          {/* No Results */}
          {sortedListings.length === 0 && (
            <div style={{
              textAlign: 'center',
              padding: '4rem 2rem',
              color: 'rgba(255, 255, 255, 0.6)'
            }}>
              <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>üîç</div>
              <h3 style={{ fontSize: '1.5rem', marginBottom: '0.5rem', color: 'white' }}>No items found</h3>
              <p>Try adjusting your filters or search terms</p>
            </div>
          )}
        </div>

        {/* Floating Action Button */}
        <button style={{
          position: 'fixed',
          bottom: '2rem',
          right: '2rem',
          background: 'linear-gradient(135deg, #D22030 0%, #8b1a1a 100%)',
          color: 'white',
          padding: '1.25rem 2rem',
          borderRadius: '50px',
          boxShadow: '0 20px 40px rgba(210, 32, 48, 0.4)',
          border: 'none',
          cursor: 'pointer',
          zIndex: 50,
          transition: 'all 0.3s',
          fontWeight: '800',
          fontSize: '1.125rem',
          display: 'flex',
          alignItems: 'center',
          gap: '0.75rem'
        }}
        onMouseEnter={(e) => {
          (e.target as HTMLElement).style.transform = 'scale(1.15) rotate(5deg)';
          (e.target as HTMLElement).style.boxShadow = '0 25px 50px rgba(210, 32, 48, 0.6)';
        }}
        onMouseLeave={(e) => {
          (e.target as HTMLElement).style.transform = 'scale(1) rotate(0deg)';
          (e.target as HTMLElement).style.boxShadow = '0 20px 40px rgba(210, 32, 48, 0.4)';
        }}
        >
          <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Sell Item
        </button>

        {/* Contact Modal */}
        {showContactModal && selectedItem && (
          <div 
            style={{
              position: 'fixed',
              inset: 0,
              background: 'rgba(0, 0, 0, 0.8)',
              backdropFilter: 'blur(10px)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 100,
              padding: '2rem'
            }}
            onClick={() => setShowContactModal(false)}
          >
            <div 
              style={{
                background: 'linear-gradient(135deg, rgba(30, 30, 46, 0.98), rgba(42, 26, 61, 0.98))',
                borderRadius: '24px',
                padding: '2.5rem',
                maxWidth: '500px',
                width: '100%',
                boxShadow: '0 25px 50px rgba(0, 0, 0, 0.5)',
                border: '1px solid rgba(255, 255, 255, 0.1)',
                animation: 'modalSlideIn 0.3s ease-out'
              }}
              onClick={(e) => e.stopPropagation()}
            >
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '2rem' }}>
                <div>
                  <h2 style={{ 
                    fontSize: '2rem', 
                    fontWeight: '800', 
                    color: 'white', 
                    marginBottom: '0.5rem' 
                  }}>
                    Contact Seller
                  </h2>
                  <p style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: '1rem' }}>
                    Send a message to {selectedItem.seller}
                  </p>
                </div>
                <button
                  onClick={() => setShowContactModal(false)}
                  style={{
                    background: 'rgba(255, 255, 255, 0.1)',
                    border: 'none',
                    color: 'white',
                    padding: '0.75rem',
                    borderRadius: '12px',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.2)'}
                  onMouseLeave={(e) => (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.1)'}
                >
                  <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                  </svg>
                </button>
              </div>

              {/* Item Info */}
              <div style={{
                display: 'flex',
                gap: '1rem',
                background: 'rgba(255, 255, 255, 0.05)',
                padding: '1.25rem',
                borderRadius: '16px',
                marginBottom: '2rem',
                border: '1px solid rgba(255, 255, 255, 0.1)'
              }}>
                <img
                  src={selectedItem.image}
                  alt={selectedItem.title}
                  style={{
                    width: '80px',
                    height: '80px',
                    borderRadius: '12px',
                    objectFit: 'cover'
                  }}
                />
                <div>
                  <h3 style={{ color: 'white', fontWeight: '700', fontSize: '1.125rem', marginBottom: '0.5rem' }}>
                    {selectedItem.title}
                  </h3>
                  <p style={{ color: '#D22030', fontWeight: '800', fontSize: '1.5rem' }}>
                    ${selectedItem.price}
                  </p>
                </div>
              </div>

              {/* Message Form */}
              <form onSubmit={(e) => {
                e.preventDefault();
                alert('Message sent to seller! (Demo)');
                setShowContactModal(false);
              }}>
                <div style={{ marginBottom: '1.5rem' }}>
                  <label style={{ 
                    display: 'block', 
                    color: 'white', 
                    fontWeight: '600', 
                    marginBottom: '0.75rem',
                    fontSize: '1rem'
                  }}>
                    Your Message
                  </label>
                  <textarea
                    placeholder="Hi! I'm interested in this item..."
                    rows={5}
                    style={{
                      width: '100%',
                      padding: '1rem',
                      borderRadius: '12px',
                      border: '1px solid rgba(255, 255, 255, 0.2)',
                      background: 'rgba(255, 255, 255, 0.05)',
                      color: 'white',
                      fontSize: '1rem',
                      resize: 'vertical',
                      outline: 'none',
                      fontFamily: 'inherit'
                    }}
                    required
                  />
                </div>

                <div style={{ display: 'flex', gap: '1rem' }}>
                  <button
                    type="submit"
                    style={{
                      flex: 1,
                      background: 'linear-gradient(135deg, #D22030, #8b1a1a)',
                      color: 'white',
                      padding: '1rem',
                      borderRadius: '14px',
                      border: 'none',
                      cursor: 'pointer',
                      fontWeight: '700',
                      fontSize: '1.125rem',
                      transition: 'all 0.3s',
                      boxShadow: '0 8px 20px rgba(210, 32, 48, 0.4)'
                    }}
                    onMouseEnter={(e) => {
                      (e.target as HTMLElement).style.transform = 'translateY(-2px)';
                      (e.target as HTMLElement).style.boxShadow = '0 12px 30px rgba(210, 32, 48, 0.5)';
                    }}
                    onMouseLeave={(e) => {
                      (e.target as HTMLElement).style.transform = 'translateY(0)';
                      (e.target as HTMLElement).style.boxShadow = '0 8px 20px rgba(210, 32, 48, 0.4)';
                    }}
                  >
                    Send Message
                  </button>
                  <button
                    type="button"
                    onClick={() => setShowContactModal(false)}
                    style={{
                      background: 'rgba(255, 255, 255, 0.1)',
                      color: 'white',
                      padding: '1rem 2rem',
                      borderRadius: '14px',
                      border: '1px solid rgba(255, 255, 255, 0.2)',
                      cursor: 'pointer',
                      fontWeight: '600',
                      fontSize: '1.125rem',
                      transition: 'all 0.3s'
                    }}
                    onMouseEnter={(e) => (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.15)'}
                    onMouseLeave={(e) => (e.target as HTMLElement).style.background = 'rgba(255, 255, 255, 0.1)'}
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        )}
      </div>

      <style>{`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.8; }
        }
        
        @keyframes float {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          33% { transform: translate(30px, -30px) rotate(120deg); }
          66% { transform: translate(-20px, 20px) rotate(240deg); }
        }
        
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes modalSlideIn {
          from {
            opacity: 0;
            transform: scale(0.9) translateY(20px);
          }
          to {
            opacity: 1;
            transform: scale(1) translateY(0);
          }
        }
      `}</style>
    </div>
  );
};

export default Marketplace;